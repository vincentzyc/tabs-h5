<template>
  <div class="flex align-middle form-item">
    <div class="form-label">收货地址</div>
    <div @click="openCityPicker()" class="form-input flex-auto flex align-middle disabled-input">
      <div class="wg-input" :class="{ placeholder: !showValue }">{{
        showValue ? showValue : "请选择省份/地市/县区"
      }}</div>
    </div>
    <CityPicker @selected="closePicker" :locationCity="locationCity" ref="domCityPicker" v-model:show="showPicker" />
  </div>
</template>

<script lang="ts">
import { computed, defineComponent, ref } from "vue";
import { checkCity } from "@/composition/business/use-verify-data";
// import { useStore } from '@/store';
// import { CommonApi } from '@/api';

export default defineComponent({
  name: "FormCity",
  props: {
    modelValue: {
      required: true,
      type: Array,
    },
    locationCity: {
      required: true,
      type: Array,
    },
  },
  emits: ["update:modelValue"],
  setup(props, { emit }) {
    // const store = useStore()
    // const cjData = computed(() => store.state.cjData)
    // const autoRegion = computed(() => store.state.autoRegion)
    const domCityPicker = ref();
    const showPicker = ref(false);
    const showValue = computed(() => {
      return props.modelValue.length > 0 ? props.modelValue.join(" ") : "";
    });
    // const initCityPicker = async () => {
    //   if (!hadInitCity.value && cjData.value?.productCode) {
    //     const res = await CommonApi.getCityInfo({ productCode: cjData.value?.productCode || '' })
    //     if (Array.isArray(res) && res.length > 0) {
    //       if (autoRegion.value.length > 0) {
    //         domCityPicker.value?.initCity(res, autoRegion.value);  //初始化地址选择组件
    //       } else {
    //         domCityPicker.value?.initCity(res);  //初始化地址选择组件
    //       }
    //       hadInitCity.value = true
    //     }
    //   }
    // }
    const openCityPicker = () => {
      // initCityPicker()
      showPicker.value = true;
    };
    const closePicker = (val: string[]) => {
      if (Array.isArray(val) && val.length === 3) {
        emit("update:modelValue", val);
        checkCity(val);
      }
    };
    return {
      showPicker,
      showValue,
      domCityPicker,
      checkCity,
      openCityPicker,
      closePicker,
    };
  },
});
</script>
